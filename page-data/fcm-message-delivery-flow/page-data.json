{"componentChunkName":"component---src-templates-post-template-tsx","path":"/fcm-message-delivery-flow/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<blockquote>\n<p>사용자의 디바이스에 “띵!”하고 알림이 도착하기까지, 그 이면에서는 어떤 일이 벌어지고 있을까?</p>\n</blockquote>\n<hr>\n<h2>🧩 서론: 그날의 푸시 알림</h2>\n<p>2025년 어느 날, 회사 서비스에서 이벤트 알림을 푸시로 날리기로 결정했다.<br>\n우리 백엔드 팀의 역할은 단순했다.</p>\n<ul>\n<li>“사용자에게 메시지를 보내라!”</li>\n</ul>\n<p>하지만, 메시지는 ‘어떻게’ 사용자에게 전달되는 걸까?<br>\nFirebase Cloud Messaging(이하 FCM)을 사용하고 있었지만,<br>\n그 흐름을 제대로 이해한 건 이번이 처음이었다.</p>\n<hr>\n<h2>🌐 1. 전체 아키텍처 개요</h2>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">[내 서버] ──▶ [FCM Server] ──▶ [사용자 디바이스 (웹/앱)] ──▶ [알림 표시]\n                 ▲                          ▲\n                 │                          │\n           인증/토큰 관리               Service Worker</code></pre></div>\n<hr>\n<h2>2️⃣ Step-by-Step 흐름: 알림이 만들어지고 전달되기까지</h2>\n<h3>1단계: 클라이언트가 Firebase와 연결하고 등록 토큰을 발급받다</h3>\n<p>웹 또는 앱에서 다음 과정을 거친다:</p>\n<ol>\n<li>Firebase SDK 초기화 (firebase-messaging.js)</li>\n<li>사용자에게 알림 권한 요청</li>\n<li>권한 허용 시, FCM은 “registration token”을 발급</li>\n<li>이 토큰을 <strong>내 서버에 저장</strong>해둠</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// Web 예시</span>\n<span class=\"token keyword\">const</span> messaging <span class=\"token operator\">=</span> firebase<span class=\"token punctuation\">.</span><span class=\"token function\">messaging</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> token <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> messaging<span class=\"token punctuation\">.</span><span class=\"token function\">getToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">vapidKey</span><span class=\"token operator\">:</span> <span class=\"token string\">'YOUR_PUBLIC_VAPID_KEY'</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>👉 이 <code class=\"language-text\">token</code>은 사용자의 디바이스를 식별하는 유일한 키다.</p>\n<hr>\n<h3>2단계: 서버에서 메시지를 만들고 FCM에 전달</h3>\n<p>서버 측에서는 REST API를 통해 메시지를 전송한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"http\"><pre class=\"language-http\"><code class=\"language-http\">POST https://fcm.googleapis.com/v1/projects/{project-id}/messages:send\n<span class=\"token header\"><span class=\"token header-name keyword\">Authorization</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">Bearer {access_token}</span></span>\n<span class=\"token header\"><span class=\"token header-name keyword\">Content-Type</span><span class=\"token punctuation\">:</span> <span class=\"token header-value\">application/json</span></span></code></pre></div>\n<p>요청 바디 예시:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"message\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"token\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"user_device_token\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"notification\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"새 소식!\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"body\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"당신을 위한 새로운 이벤트가 도착했어요.\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"data\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"url\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"/event/detail\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>✅ <code class=\"language-text\">notification</code>은 브라우저에서 자동 알림 생성<br>\n✅ <code class=\"language-text\">data</code>는 개발자가 수동 처리 가능</p>\n<hr>\n<h3>3단계: Firebase가 사용자 디바이스로 푸시 전달</h3>\n<ul>\n<li>Firebase는 등록된 <code class=\"language-text\">token</code>을 통해 디바이스와 연결</li>\n<li>메시지를 Web Push 프로토콜 또는 Android/iOS 전용 채널을 통해 전송</li>\n</ul>\n<p>🧠 이때까지의 흐름:</p>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">[Server] → [FCM] → [Push Service] → [사용자 브라우저]</code></pre></div>\n<hr>\n<h3>4단계: 브라우저 백그라운드에서 Service Worker가 메시지 수신</h3>\n<p>브라우저가 꺼지지 않고 백그라운드에서 살아있다면,<br>\n<code class=\"language-text\">firebase-messaging-sw.js</code> 또는 custom <code class=\"language-text\">service-worker.js</code>가 메시지를 받는다.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// firebase-messaging-sw.js</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'push'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> payload <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  self<span class=\"token punctuation\">.</span>registration<span class=\"token punctuation\">.</span><span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span>payload<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">.</span>title<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> payload<span class=\"token punctuation\">.</span>notification<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> <span class=\"token string\">'/icon.png'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">data</span><span class=\"token operator\">:</span> payload<span class=\"token punctuation\">.</span>data<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>🧩 알림 표시 후 클릭 시, 특정 URL로 이동하거나 액션 처리 가능</p>\n<hr>\n<h2>🎯 흐름 요약 다이어그램</h2>\n<div class=\"gatsby-highlight\" data-language=\"plaintext\"><pre class=\"language-plaintext\"><code class=\"language-plaintext\">(1) 클라이언트가 FCM 토큰 발급\n        ↓\n(2) 서버가 메시지를 생성\n        ↓\n(3) FCM 서버로 메시지 전송\n        ↓\n(4) FCM이 대상 디바이스로 Push\n        ↓\n(5) Service Worker가 수신 후 알림 표시\n        ↓\n(6) 사용자가 알림 클릭 (→ 웹 페이지 이동 등)</code></pre></div>\n<hr>\n<h2>❗️주의할 점</h2>\n<ul>\n<li><strong>알림 권한은 수동 허용이 필요</strong> (특히 브라우저에서)</li>\n<li><strong>브라우저가 꺼져 있으면 수신 불가</strong>\n<ul>\n<li>크롬의 경우 브라우저 프로세스가 종료되면 푸시 수신 실패</li>\n<li>반면, Edge 또는 PWA 설치 시 OS 백그라운드 유지로 수신 가능</li>\n</ul>\n</li>\n<li><strong>token 유효성 관리</strong> 중요\n<ul>\n<li>오래된 token은 유효하지 않으므로 주기적 재발급 필요</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2>🔍 실제 활용 팁</h2>\n<ul>\n<li>모바일 웹 앱이라면 PWA로 설치 유도 → 푸시 수신 안정성 증가</li>\n<li>사용자 그룹에 따라 topic 메시지 사용 가능 (<code class=\"language-text\">/topics/news</code>)</li>\n<li>사용자 액션에 따라 알림 전송: 예약, 뉴스, 댓글, 좋아요 등</li>\n</ul>\n<hr>\n<h2>🧠 마무리하며</h2>\n<p>“그냥 알림 보내는 거잖아.”<br>\n그렇게 생각했지만, 실제로는 꽤 섬세한 흐름과 관리가 필요한 영역이었다.</p>\n<p>Firebase 덕분에 푸시는 쉬워졌지만,<br>\n<strong>어디서 누가 어떤 흐름으로 받는지를 파악</strong>해야<br>\n실제로 <strong>사용자 경험을 개선하는 알림</strong>을 만들 수 있다.</p>\n<hr>\n<blockquote>\n<p>푸시는 기술이 아니라 연결이다.<br>\n알림 하나에도 수많은 기술자들의 고민과 흐름이 숨어 있다.</p>\n</blockquote>","frontmatter":{"title":"🔔 FCM 메시지가 사용자에게 도달하기까지","summary":"Firebase Cloud Messaging(Firebase Server → 브라우저/디바이스까지)의 작동","date":"2025.07.17.","categories":["Web"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVUlEQVR42o1Sy27aUBBl3z/prh+QT+iiq35Bd/2CdpEo6qZqWjWLFBIimgbSR6gD5lU5Dn7iOEmLzcMhMUmK8QsEkQqoBNuA6PgSReqiUqWjuUdz7zkzVzMBRh/9J1jTZU2PszzWcOaZgH80bwA0wj+VhkNc9PbrfULtkVcDBukDNLLk7AlrjSEyhksjOwqIMZ5bC60p3RwWVUMqiWWlVDjV89oQVTa9bNlI8nJaPE1w8jfFZq0p2+ipwoagar61PkpV29t06VLvW+JjS15WzSF0wehOgLUmGVGhGU44Lh5QbPr4fL/hUFfd4caCiz8oaRR+5qyEY8kcWaldVmXitMKkOIm4HPhizp5ifBlL5VL7TCJLPA/FHy5G1+LZGXZ/Jt1L408eLcXXd7DZbGa3O61Ov1JvPgvHYodnrO76ldOiQjEcf/QDKmNCNV65zlXNbu2pU1mQ6wexE/vddty2W+1Ot9O9Vs7r3d8DStHIn0MkPlHT+QJ5VMJJPiM1hPaU1j2q6TJan7FnuNR8E/4YjH5deh18ufZ+9cPu2wwZ5RW/MqXdcNZ4T9KDGXFPMnhrDBk0NoduerQ2hEe4rIcyhxFS3sqXNonvQaKYU39xBrRtuNladxWjFkOfX+3kgMO0kH4EAMIaXrJsr3wiXkQSy5vY0vqXXfGCaqBRwdLgZTuUFbeoMrgmZJMzvTvxXF+wx7laJ0IWY3wtxtUoaMdwYf4BuAYG/yy0JkJ7AgtDa7Bwozsx4lDfEVoTcAHc5v0NQ3dghjD/7Yj+W+zrNf8Nir71fLf/AIQseeJPyulKAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/d7b75b2a7160bc71ed8bea4108bc609b/4d776/FcmAlert.png","srcSet":"/static/d7b75b2a7160bc71ed8bea4108bc609b/4a410/FcmAlert.png 384w,\n/static/d7b75b2a7160bc71ed8bea4108bc609b/f5189/FcmAlert.png 768w,\n/static/d7b75b2a7160bc71ed8bea4108bc609b/4d776/FcmAlert.png 1536w","sizes":"(min-width: 1536px) 1536px, 100vw"},"sources":[{"srcSet":"/static/d7b75b2a7160bc71ed8bea4108bc609b/b642b/FcmAlert.webp 384w,\n/static/d7b75b2a7160bc71ed8bea4108bc609b/c9564/FcmAlert.webp 768w,\n/static/d7b75b2a7160bc71ed8bea4108bc609b/18b4b/FcmAlert.webp 1536w","type":"image/webp","sizes":"(min-width: 1536px) 1536px, 100vw"}]},"width":1536,"height":1024}},"publicURL":"/static/d7b75b2a7160bc71ed8bea4108bc609b/FcmAlert.png"}}}}]}},"pageContext":{"slug":"/fcm-message-delivery-flow/"}},"staticQueryHashes":[],"slicesMap":{}}